# Checkov Configuration for Local Pulse
# IaC Security Scanning for Terraform, Dockerfile, Kubernetes
#
# Run: checkov -d . --config-file .checkov.yaml

# Frameworks to scan
framework:
  - terraform
  - dockerfile
  - kubernetes
  - helm
  - yaml

# Output settings
quiet: true
compact: true
output: cli

# Skip checks (with justification)
skip-check:
  # Dockerfile
  - CKV_DOCKER_2   # HEALTHCHECK - not all containers need it
  - CKV_DOCKER_3   # USER - handled by distroless base images

  # Terraform - adjust based on your infrastructure
  # - CKV_GCP_XX   # Uncomment and add GCP-specific skips if needed

# Check-specific settings
check:
  # Ensure these critical checks always run
  - CKV_DOCKER_1   # Ensure USER is not root
  - CKV_DOCKER_7   # Ensure base image uses specific version tag
  - CKV_DOCKER_8   # Ensure COPY with --chown is used

  # Kubernetes security
  - CKV_K8S_1      # Ensure readOnlyRootFilesystem
  - CKV_K8S_8      # Ensure allowPrivilegeEscalation is false
  - CKV_K8S_9      # Ensure containers run as non-root
  - CKV_K8S_21     # Ensure hostNetwork is not set to true
  - CKV_K8S_22     # Ensure hostPID is not set to true
  - CKV_K8S_28     # Ensure network policy is defined
  - CKV_K8S_38     # Ensure service account tokens are not auto-mounted

# Directories to scan
directory:
  - .

# Directories/files to skip
skip-path:
  - node_modules
  - .venv
  - .git
  - dist
  - build
  - __pycache__
  - "*.lock"
  - poetry.lock
  - package-lock.json

# External checks (custom policies)
# external-checks-dir:
#   - .checkov/custom-checks

# Soft fail (don't exit non-zero) for these severities
# soft-fail-on:
#   - LOW
